import React, { useState, useRef, useEffect } from 'react';
import axios from 'axios';
import ErrorAlert from "../components/ErrorAlert";
import {Grid, TextField, Button, Typography, Card, CardContent, CardHeader, Box} from "@mui/material"

export default function File() {
    const [error, setError] = useState(null);
    const [fileName, setFileName] = useState("");
    const [fileContent, setFileContent] = useState();
    const [file, setFile] = useState(null);
    const formRef = useRef(null);
    const [formHeight, setFormHeight] = useState(0);

    useEffect(() => {
        setFormHeight(formRef.current.offsetHeight);
    }, []);

    const changeFileName = (event) => {
        setFileName(event.target.value);
    };
    const getFile = e => {
        e.preventDefault();
        if (fileName === "") {
            setError("入力が空です");
            return;
        }
    
        axios.get('/file', {params:{filename: fileName}})
            .then(res => {
                setError("");
                setFile(res.data);
                setFileContent(fileName);
            })
            .catch(error => {
                setError(error.response.data.message);
            });
    };
    // ...
    return (
        <>
        <Box sx={{flexGrow: 1, height: `calc(100vh - ${formHeight}px)`, display: 'flex', flexDirection: 'column'}}>
            <Box ref={formRef}>
            <Grid item xs={12}>
            <ErrorAlert error={error}/>
            <h2>ファイル検索</h2>
                <form onSubmit={getFile}>
                    <Grid container spacing={2} alignItems="center" justify="center">
                        <Grid item xs={8}>
                            <TextField
                                label="ファイル名"
                                variant="outlined"
                                value={fileName}
                                onChange={changeFileName}
                                fullWidth
                            />
                        </Grid>
                        <Grid item xs={4}>
                            <Button variant="contained" color="primary" type="submit" fullWidth>
                                検索
                            </Button>
                        </Grid>
                    </Grid>
                </form>
            </Grid>
            </Box>
            <Box mt={2}  sx={{flexGrow: 1, overflow: 'auto'}}>
            <Grid item xs={12} sx={{height: '100%'}}>
                {file && <Card sx={{height: '100%', display: 'flex', flexDirection: 'column'}}>
                    <CardHeader title={fileContent} sx={{border: 'solid'}} />
                    <CardContent sx={{ flexGrow: 1, maxHeight: '100%', overflow: 'auto'}}>
                    <Typography variant="body1" component="p" dangerouslySetInnerHTML={{ __html: file.replace(/\n/g, '<br>') }} />
                    </CardContent>
                </Card>}
            </Grid>
            </Box>
        </Box>
        </>
    );
}





