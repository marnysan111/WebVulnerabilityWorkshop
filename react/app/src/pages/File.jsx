import React, { useState } from 'react';
import axios from 'axios';
import ErrorAlert from "../components/ErrorAlert";
import {Grid, TextField, Button, Typography, Card, CardContent, CardHeader, Box} from "@mui/material"

export default function File() {
    const [error, setError] = useState(null);
    const [fileName, setFileName] = useState("");
    const [fileContent, setFileContent] = useState();
    const [file, setFile] = useState(null);

    const changeFileName = (event) => {
        setFileName(event.target.value);
    };

    const getFile = e => {
        e.preventDefault();
        if (fileName === "") {
            setError("入力が空です");
            return;
        }

        axios.get('/file', {params:{filename: fileName}})
            .then(res => {
                setError("");
                setFile(res.data);
                setFileContent(fileName);
            })
            .catch(error => {
                setError(error.response.data.message);
            });
    };

    return (
        <>
            <ErrorAlert error={error}/>
            <h2>ファイル検索</h2>
            <Grid item xs={12}>
                <form onSubmit={getFile}>
                    <Grid container spacing={2} alignItems="center" justify="center">
                        <Grid item xs={8}>
                            <TextField
                                label="ファイル名"
                                variant="outlined"
                                value={fileName}
                                onChange={changeFileName}
                                fullWidth
                            />
                        </Grid>
                        <Grid item xs={4}>
                            <Button variant="contained" color="primary" type="submit" fullWidth>
                                検索
                            </Button>
                        </Grid>
                    </Grid>
                </form>
                <Box mt={2}>
                    {file && <Card>
                        <CardHeader title={fileContent} />
                        <CardContent >
                            <Typography variant="body1" component="p" dangerouslySetInnerHTML={{ __html: file.replace(/\n/g, '<br>') }} />
                        </CardContent>
                    </Card>}
                </Box>
            </Grid>
        </>
    );
}
