import axios from 'axios';
import { Button, TextField, Grid } from '@mui/material';
import { useState } from 'react';
import ErrorAlert from '../components/ErrorAlert';

function Image() {
    const [path, setPath] = useState('');
    const [file, setFile] = useState([])
    const [imageUrl, setImageUrl] = useState(null);
    const [error, setError] = useState(null);

    const changeImage = (event) => {
        setPath(event.target.value);
    };

    const changeFileInput = (event) => {
      setPath(event.target.value);
  };
    const getImage = e => {
        e.preventDefault();
        if (path === "") {
          setError("入力が空です");
          return false
        }
        axios.get('/image', {
          params: {
            path: path,
          }
        })
        .then(res => {
          setError("")
          setImageUrl(res.data.image);
        })
        .catch(error => {
          console.log(error)
            setError(error.response.data.message);
            setImageUrl(null);  // Clear the image
        });
    }
    const getFile = e => {
      e.preventDefault();
      axios.get('/file', {
      })
      .then(res => {
        setError("")
        console.log(res)
        setFile(res.data.file)
      })
      .catch(error => {
        console.log(error)
        setError(error.response.data.message);
        setFile([]);  // Clear the image
      });
    }
    return (
        <>
        <ErrorAlert
          error = {error}
        />
            <h2>画像検索</h2> 
            <Grid item xs={12}>
                {file}
                <Button onClick={getFile}>ファイル検索</Button>
                <form onSubmit={getImage}>
                    <Grid container spacing={2} alignItems="center" justify="center">
                        <Grid item xs={8}>
                            <TextField
                                label="画像名"
                                variant="outlined"
                                value={path}
                                onChange={changeImage}
                                fullWidth
                            />
                        </Grid>
                        <Grid item xs={4}>
                            <Button variant="contained" color="primary" type="submit" fullWidth>
                                検索
                            </Button>
                        </Grid>
                    </Grid>
                </form>
                {imageUrl && <img src={imageUrl} alt="From server" />}
            </Grid>
        </>
    );
}

export default Image;
