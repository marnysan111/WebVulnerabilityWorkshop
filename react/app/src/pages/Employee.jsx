import axios from 'axios'
import { Button, TextField, Box } from '@mui/material';
import {Grid, CssBaseline} from '@mui/material';
import React, { useState, useRef, useEffect } from 'react';
import UserTable from '../components/Table';
import ErrorAlert from '../components/ErrorAlert';

function Employee() {
    const [name, setName] = useState("");
    const [user, setUser] = useState([]);
    const [error, setError] = useState('');
    const formRef = useRef(null)
    const [formHeight, setFormHeight] = useState(0);

    useEffect(() => {
      setFormHeight(formRef.current.offsetHeight);
    }, []);

    const selectUserOne = e => {
        e.preventDefault();
        if (name === "") {
          setError("入力が空です")
          setUser("")
          return
        }
        axios.get('/employee/search',{params:{name: name}})
        .then(res => {
          setUser(res.data.result)
          if (res.data.result.length === 0) {
            setError("該当なし")
            return
          }
          setError("")
        })
        .catch(function (error){
          setError(error.response.data.message)
          setUser('')
        })
      }


    const setNamehandler = (event) => {
      setName(event.target.value)
    }
    return (
    <>
    <CssBaseline />
      <Box sx={{flexGrow: 1, height: `calc(100vh - ${formHeight}px)`, display: 'flex', flexDirection: 'column'}}>
      <Box ref={formRef}>
      <ErrorAlert message={error}/>
      <h2>社員検索</h2>
      <Grid item xs={12}>
        <form onSubmit={selectUserOne}>
          <Grid container spacing={2} alignItems="center" justify="center">
              <Grid item xs={8}>
                  <TextField
                      label="名前"
                      variant="outlined"
                      fullWidth
                      value={name} 
                      onChange={setNamehandler}
                  />
              </Grid>
              <Grid item xs={4}>
                  <Button variant="contained" color="primary" type="submit" fullWidth>
                      検索
                  </Button>
              </Grid>
          </Grid>
        </form>
        </Grid>
      </Box>
      <Box mt={2}  sx={{flexGrow: 1, overflow: 'auto'}}>
        <Grid item xs={12} sx={{height: '100%'}}>
        <UserTable 
        user = {user}
      />
        </Grid>
      </Box>
          
      </Box>
    </>
  )}


export default Employee;